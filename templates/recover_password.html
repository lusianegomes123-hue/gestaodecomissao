{% extends "base.html" %}

{% block content %}
<div class="card" style="max-width: 400px; margin: 2rem auto;">
    <h2 style="color: var(--primary-color); text-align: center;">Recuperar Senha</h2>

    {% if not valid_user %}
    <!-- Passo 1: Validação -->
    <form method="POST" action="{{ url_for('recover_password') }}">
        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
            Para segurança, digite seu <strong>Nome Completo</strong> e um <strong>E-mail</strong> que contenha parte do
            seu nome.
        </p>

        <label for="full_name">Nome Completo (Cadastrado):</label>
        <input type="text" id="full_name" name="full_name" required placeholder="Ex: Lusiane Gomes">

        <label for="email">E-mail de Confirmação:</label>
        <input type="email" id="email" name="email" required placeholder="Ex: lusiane@gmail.com">

        <button type="submit" style="width: 100%; margin-top: 1rem;">Verificar</button>

        <div style="text-align: center; margin-top: 1rem;">
            <a href="{{ url_for('login') }}">Voltar para Login</a>
        </div>
    </form>

    {% else %}
    <!-- Passo 2: Redefinição -->
    <form method="POST" action="{{ url_for('recover_password') }}">
        <div style="background-color: #e6ffe6; color: green; padding: 10px; border-radius: 5px; margin-bottom: 1rem;">
            ✅ Validação confirmada para <strong>{{ valid_user.full_name }}</strong>.
        </div>

        <!-- Reenvia dados para re-validação silenciosa -->
        <input type="hidden" name="full_name" value="{{ valid_user.full_name }}">
        <input type="hidden" name="email" value="{{ email_attempt }}">
        <input type="hidden" name="step" value="reset">

        <label for="new_password">Nova Senha:</label>
        <input type="password" id="new_password" name="new_password" required>

        <button type="submit" style="width: 100%; margin-top: 1rem;">Salvar Nova Senha</button>
    </form>
    {% endif %}
</div>
{% endblock %}